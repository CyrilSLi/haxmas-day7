<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haxmas Day 7</title>
    <script src="https://cdn.jsdelivr.net/npm/epoxy-tls-polyfill@1/dist/javascript.min.js"></script>
    <style>
        * {
            touch-action: manipulation;
            margin: 0px;
            padding: 0px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            font-weight: bold;
            border: none;
            font-family: sans-serif;
        }
        body {
            background-image: url("img/tree.png");
            background-size: auto calc(100dvh - 10rem);
            background-repeat: no-repeat;
            background-position: center 11rem;
            background-color: black;
        }
        h1, p {
            color: white;
            text-align: center;
        }
        h1 {
            font-size: 4rem;
            margin: 1rem 0;
        }
        p {
            font-size: 2rem;
            margin: 0.5rem 0;
        }
        img {
            position: fixed;
            height: 5dvh;
            width: 5dvh;
            transform: translate(-50%, -50%);
            object-fit: cover;
            border-radius: 1rem;
            cursor: pointer;
        }
        img:hover {
            transform: translate(-50%, -50%) scale(3);
            z-index: 1;
            transition: 0.5s;
        }
    </style>
</head>
<body>
</body>
    <h1>Haxmas Day 7</h1>
    <p>Winnipeg Transit Tree</p>
    <p id="loading" style="color: cyan;">Loading...</p>
    <script type="module">
        const wikiPage = await fetch("https://cptdb.ca/wiki/api.php?action=parse&page=Winnipeg_Transit&prop=text&format=json");
        const wikiHtml = new DOMParser().parseFromString((await wikiPage.json()).parse.text['*'], "text/html");
        let fleetTable = [...wikiHtml.getElementsByTagName('th')].filter((el) => el.textContent.trim().toLowerCase() === "fleet number")[0];
        while (fleetTable.tagName !== "TABLE") {
            fleetTable = fleetTable.parentElement;
        }
        let row = 0, col = 0;
        [...fleetTable.getElementsByTagName('tr')].forEach((tr, i) => {
            if (i === 0) {
                return;
            }
            const imgLink = document.createElement("a");
            imgLink.href = "https://cptdb.ca/wiki/" + tr.querySelector("td a").href.split("/wiki/")[1];
            imgLink.target = "_blank";
            imgLink.innerHTML = `<img src="https://cptdb.ca/wiki/${tr.querySelector("td img")?.src.split("/wiki/")[1]}" style="top: calc(11rem + ((100dvh - 11rem) / 9 * ${row + 1})); left: calc(50dvw + ${col * 3}dvh);">`; 
            document.body.appendChild(imgLink);
            if (col == row) {
                row++;
                col = -row;
            } else {
                col += 2;
            }
        });
        document.getElementById('loading').remove();
    </script>
</html>